<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Warung Pedia • Payment</title>
  <meta name="color-scheme" content="dark">
  <style>
    :root{
      --bg:#0a0d11;
      --bg-2:#0e1117;
      --card:#0f141a;
      --text:#e8edf2;
      --muted:#9aa4af;
      --a1:#6ee7ff; --a2:#a78bfa; --a3:#34d399;
      --ring: 0 0 0 2px rgba(110,231,255,.25), 0 18px 48px rgba(0,0,0,.6);
      --radius: 20px;
    }
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:16px/1.6 Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      color:var(--text); background: radial-gradient(1200px 600px at 10% 10%, #0c1218 0%, #0a0d11 50%, #07090c 100%);
      overflow-x:hidden;
    }

    /* ==== Animated background layer (parallax grid + glow) ==== */
    .bg-wrap{position:fixed; inset:0; z-index:-1; perspective:1200px; overflow:hidden;}
    .bg-grid{
      position:absolute; inset:-10% -10% -10% -10%;
      background:
        radial-gradient(1200px 600px at 90% 10%, rgba(167,139,250,.08),transparent 60%),
        radial-gradient(1000px 800px at 10% 90%, rgba(110,231,255,.07),transparent 60%),
        linear-gradient(transparent 0 0),
        repeating-linear-gradient(0deg, rgba(255,255,255,.06) 0 1px, transparent 1px 80px),
        repeating-linear-gradient(90deg, rgba(255,255,255,.05) 0 1px, transparent 1px 80px);
      transform: rotateX(35deg) translateZ(-200px);
      animation: gridFloat 18s ease-in-out infinite;
      filter: drop-shadow(0 10px 40px rgba(0,0,0,.6));
    }
    @keyframes gridFloat{
      0%,100%{transform: rotateX(35deg) translateZ(-200px) translateY(0)}
      50%{transform: rotateX(35deg) translateZ(-220px) translateY(-10px)}
    }
    .nebula{
      position:absolute; inset:0;
      background: radial-gradient(600px 300px at 70% 30%, rgba(110,231,255,.08), transparent 60%),
                  radial-gradient(700px 350px at 30% 70%, rgba(52,211,153,.06), transparent 60%);
      mix-blend-mode: screen;
      animation: neb 12s ease-in-out infinite alternate;
    }
    @keyframes neb{from{filter:saturate(100%) blur(0px)} to{filter:saturate(130%) blur(1px)}}

    /* ==== Layout ==== */
    .container{width:min(1100px,100% - 32px); margin:40px auto 80px}
    header{display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:22px}
    .brand{display:flex; gap:14px; align-items:center}
    .brand .logo{
      width:52px; height:52px; border-radius:16px; display:grid; place-items:center;
      font-weight:900; color:#00131a; letter-spacing:.5px;
      background:conic-gradient(from 0deg, var(--a1), var(--a2), var(--a3), var(--a1));
      box-shadow: 0 0 0 1px rgba(255,255,255,.06), 0 12px 34px rgba(103,232,249,.22);
      position:relative; isolation:isolate;
    }
    .logo::after{
      content:""; position:absolute; inset:2px; border-radius:14px;
      background:linear-gradient(145deg, rgba(255,255,255,.12), rgba(255,255,255,.02));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.25);
      z-index:-1;
    }
    .title h1{margin:0; font-size:clamp(20px,2.8vw,32px)}
    .title .tag{color:var(--muted); font-size:.95rem}

    /* ==== 3D Card + Tilt ==== */
    .grid{display:grid; gap:20px; grid-template-columns:repeat(12,1fr)}
    .card{
      grid-column:span 6; background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); padding:18px; position:relative;
      transition: transform .35s ease, box-shadow .35s ease, border-color .35s ease;
      transform-style:preserve-3d; will-change: transform;
      box-shadow: 0 8px 40px rgba(0,0,0,.5);
    }
    .card[data-tilt="true"]:hover{
      box-shadow: 0 18px 60px rgba(103,232,249,.18), 0 4px 0 rgba(255,255,255,.06) inset;
      border-color: rgba(110,231,255,.25);
    }
    @media (max-width:900px){ .card{ grid-column:span 12 } }

    .row{display:flex; align-items:center; justify-content:space-between; gap:14px; flex-wrap:wrap}
    .wallet{display:flex; align-items:center; gap:12px}
    .wallet h3{margin:0; font-size:1.1rem}
    .desc{color:var(--muted); font-size:.92rem}

    /* ==== Buttons ==== */
    .btn{
      border:none; border-radius:14px; padding:10px 16px; font-weight:800; cursor:pointer;
      color:#031015; background:linear-gradient(135deg, var(--a1), var(--a2));
      box-shadow: var(--ring); transition: transform .2s ease, filter .2s ease; position:relative; overflow:hidden;
    }
    .btn:hover{ transform: translateY(-2px) scale(1.04) }
    .btn:active{ transform: translateY(0) scale(.99) }
    .btn.secondary{ color:var(--text); background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); box-shadow:none }

    .btn .rip{ position:absolute; border-radius:999px; pointer-events:none; inset:auto; translate:-50% -50%; width:0; height:0; opacity:.6; background:rgba(255,255,255,.6); animation:rip .5s ease }
    @keyframes rip{ to{ width:500px; height:500px; opacity:0 } }

    /* ==== Number Area ==== */
    .number{ display:none; margin-top:12px; padding:12px 14px; border-radius:14px;
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08);
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; letter-spacing:.3px; font-size:.98rem;
      align-items:center; justify-content:space-between; gap:12px;
    }
    .number.visible{ display:flex }

    /* ==== Toast ==== */
    .toast{ position:fixed; left:50%; bottom:-64px; transform:translateX(-50%);
      background:#10161c; color:var(--text); border:1px solid rgba(255,255,255,.08); border-radius:12px;
      padding:10px 14px; box-shadow:0 12px 38px rgba(0,0,0,.6); transition: bottom .4s ease, opacity .4s ease; opacity:0; z-index:1000;
    }
    .toast.show{ bottom:28px; opacity:1 }

    /* ==== Modal ==== */
    .modal{ position:fixed; inset:0; display:none; place-items:center; background:rgba(2,8,18,.55); backdrop-filter: blur(6px); z-index:999}
    .modal.open{ display:grid; animation: fadeIn .35s ease }
    .modal-card{
      width:min(560px,100% - 28px); background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.09); border-radius:22px; padding:20px; animation: zoomIn .35s ease; box-shadow:0 18px 60px rgba(0,0,0,.55)
    }
    .modal-head{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px }
    .qr-wrap{ display:grid; place-items:center; padding:16px; border-radius:16px; background:#0f141a; border:1px dashed rgba(255,255,255,.18); min-height:280px }
    .qr-wrap img{ width:min(88%,320px); height:auto; border-radius:12px }

    @keyframes fadeIn{ from{opacity:0} to{opacity:1} }
    @keyframes zoomIn{ from{transform:scale(.9); opacity:0} to{transform:scale(1); opacity:1} }

    /* ==== Splash / Welcome (with One Tap ready) ==== */
    .splash{
      position:fixed; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:14px;
      background:linear-gradient(180deg, rgba(10,13,17,.9), rgba(10,13,17,.98)); z-index:1001; text-align:center; padding:24px;
      animation: fadeIn .5s ease;
    }
    .slogo{
      width:90px; height:90px; border-radius:24px; display:grid; place-items:center; font-weight:900; font-size:1.7rem; color:#00131a;
      background:conic-gradient(from 0deg, var(--a1), var(--a2), var(--a3), var(--a1));
      box-shadow:0 0 40px rgba(110,231,255,.25), inset 0 1px 0 rgba(255,255,255,.35);
      animation: spin 7s linear infinite;
    }
    @keyframes spin{ to{ rotate: 1turn } }
    .splash h1{ margin:6px 0 0; font-size:clamp(22px,3.2vw,34px) }
    .splash p{ margin:0; color:var(--muted) }
    .hint{ font-size:.9rem; color:var(--muted); margin-top:8px }

    /* Auth badge */
    .user-badge{
      display:flex; align-items:center; gap:10px; padding:8px 12px; border-radius:999px;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08);
    }
    .avatar{
      width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,var(--a1),var(--a2));display:grid;place-items:center;color:#00131a;font-weight:800
    }

    /* Greeting bar */
    .greet{
      margin:16px 0 8px; padding:12px 16px; border-radius:16px;
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08);
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
  </style>

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <!-- Background layers -->
  <div class="bg-wrap" aria-hidden="true">
    <div class="bg-grid"></div>
    <div class="nebula"></div>
  </div>

  <!-- Splash / One Tap Gate -->
  <section class="splash" id="splash">
    <div class="slogo">WP</div>
    <h1>Warung Pedia Payment</h1>
    <p>Solusi pembayaran digital yang halus, aman, dan terasa nyata.</p>

    <!-- Google One Tap bootstrap -->
    <div id="g_id_onload"
      data-client_id="YOUR_GOOGLE_CLIENT_ID"
      data-context="signin"
      data-ux_mode="popup"
      data-auto_prompt="true"
      data-use_fedcm_for_prompt="true"
      data-callback="onGoogleCredential">
    </div>

    <!-- Fallback button -->
    <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline" data-shape="pill" data-text="signin_with" data-logo_alignment="left"></div>

    <div class="hint">Jika One Tap tidak muncul, klik tombol Google di atas. (Butuh HTTPS di domain kamu)</div>

    <!-- Dev quick-enter (mock) -->
    <button class="btn secondary" id="devEnter" style="margin-top:10px">Coba Tanpa Google (Mock)</button>
  </section>

  <!-- Main App -->
  <div class="container" id="app" style="display:none">
    <header>
      <div class="brand">
        <div class="logo">WP</div>
        <div class="title">
          <h1>Warung Pedia</h1>
          <div class="tag">Metode Pembayaran • Developer: Handii</div>
        </div>
      </div>
      <div class="user-badge" id="userBadge" style="display:none">
        <div class="avatar" id="userAvatar">H</div>
        <div>
          <div id="userName" style="font-weight:700">User</div>
          <div id="userEmail" class="tag" style="line-height:1">email@example.com</div>
        </div>
      </div>
    </header>

    <!-- Greeting -->
    <div class="greet" id="greetBar" style="display:none">
      <div id="greetText">Halo! Selamat datang di website payment Warung Pedia!</div>
      <button class="btn secondary" id="signOutBtn">Ganti Akun</button>
    </div>

    <!-- Wallet Grid -->
    <section class="grid" id="walletGrid">
      <article class="card" data-tilt="true" data-wallet="DANA" data-number="0812-3456-7890">
        <div class="row">
          <div class="wallet"><h3>DANA</h3><div class="desc">E-Wallet</div></div>
          <button class="btn secondary" data-action="toggle">Tampilkan Nomor</button>
        </div>
        <div class="number"><span>•••• •••• ••••</span><div class="actions"><button class="btn" data-action="copy">Salin</button></div></div>
      </article>

      <article class="card" data-tilt="true" data-wallet="GoPay" data-number="0851-9988-7766">
        <div class="row">
          <div class="wallet"><h3>GoPay</h3><div class="desc">E-Wallet Gojek</div></div>
          <button class="btn secondary" data-action="toggle">Tampilkan Nomor</button>
        </div>
        <div class="number"><span>•••• •••• ••••</span><div class="actions"><button class="btn" data-action="copy">Salin</button></div></div>
      </article>

      <article class="card" data-tilt="true" data-wallet="OVO" data-number="0899-1122-3344">
        <div class="row">
          <div class="wallet"><h3>OVO</h3><div class="desc">Pembayaran cepat</div></div>
          <button class="btn secondary" data-action="toggle">Tampilkan Nomor</button>
        </div>
        <div class="number"><span>•••• •••• ••••</span><div class="actions"><button class="btn" data-action="copy">Salin</button></div></div>
      </article>

      <article class="card" data-tilt="true" data-wallet="ShopeePay" data-number="0813-5566-7788">
        <div class="row">
          <div class="wallet"><h3>ShopeePay</h3><div class="desc">SPay</div></div>
          <button class="btn secondary" data-action="toggle">Tampilkan Nomor</button>
        </div>
        <div class="number"><span>•••• •••• ••••</span><div class="actions"><button class="btn" data-action="copy">Salin</button></div></div>
      </article>

      <article class="card" data-tilt="true" style="grid-column:span 12">
        <div class="row">
          <div class="wallet"><h3>QRIS (All Payment)</h3></div>
          <button class="btn" id="showQris">Tampilkan QRIS</button>
        </div>
      </article>
    </section>
  </div>

  <!-- Modal QRIS -->
  <div class="modal" id="qrisModal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-head">
        <h3>QRIS • Scan untuk bayar</h3>
        <button class="btn secondary" id="closeQris">Tutup</button>
      </div>
      <div class="qr-wrap">
        <img id="qrisImg" alt="QRIS Code" src="https://api.qrserver.com/v1/create-qr-code/?size=280x280&data=QRIS"/>
      </div>
      <div class="modal-head" style="margin-top:12px; justify-content:flex-end;">
        <button class="btn" id="downloadQris">Unduh Gambar</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast">Tersalin ke clipboard</div>

  <script>
    // ===== Small utilities =====
    const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));
    const $  = (sel, ctx=document) => ctx.querySelector(sel);
    const toast = (msg) => {
      const t = $('#toast'); t.textContent = msg; t.classList.add('show'); playBeep();
      setTimeout(()=> t.classList.remove('show'), 1800);
    };
    const ripple = (e) => {
      const b = e.currentTarget;
      const r = document.createElement('span');
      r.className = 'rip'; r.style.left = e.offsetX + 'px'; r.style.top = e.offsetY + 'px';
      b.appendChild(r); setTimeout(()=> r.remove(), 520);
    };

    // ===== Web Audio small beep =====
    let _ctx;
    function playBeep(){
      try{
        _ctx = _ctx || new (window.AudioContext||window.webkitAudioContext)();
        const o = _ctx.createOscillator(); const g = _ctx.createGain();
        o.type = "triangle"; o.frequency.value = 880; g.gain.setValueAtTime(0.06, _ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.0001, _ctx.currentTime + .15);
        o.connect(g).connect(_ctx.destination); o.start(); o.stop(_ctx.currentTime + .16);
      }catch(e){}
    }

    // ===== 3D tilt on cards =====
    $$('.card[data-tilt="true"]').forEach(card=>{
      let rAF;
      const tilt = (e)=>{
        const b = card.getBoundingClientRect();
        const x = (e.clientX - b.left) / b.width, y = (e.clientY - b.top) / b.height;
        const rx = (y - .5) * 6; const ry = (x - .5) * -6;
        cancelAnimationFrame(rAF);
        rAF = requestAnimationFrame(()=> card.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg) translateZ(0)`);
      };
      const reset = ()=> card.style.transform = '';
      card.addEventListener('mousemove', tilt);
      card.addEventListener('mouseleave', reset);
    });

    // ===== Buttons ripple =====
    $$('.btn').forEach(btn=> btn.addEventListener('click', ripple));

    // ===== Wallet toggle & copy =====
    $$('#walletGrid .card[data-wallet]').forEach(card=>{
      const btnToggle = card.querySelector('[data-action="toggle"]');
      const zone = card.querySelector('.number');
      const btnCopy = card.querySelector('[data-action="copy"]');
      btnToggle?.addEventListener('click', ()=>{
        const opened = zone.classList.toggle('visible');
        zone.querySelector('span').textContent = opened ? card.dataset.number : '•••• •••• ••••';
        btnToggle.textContent = opened ? 'Sembunyikan Nomor' : 'Tampilkan Nomor';
      });
      btnCopy?.addEventListener('click', async ()=>{
        await navigator.clipboard.writeText(card.dataset.number);
        toast(`${card.dataset.wallet} • Nomor tersalin`);
      });
    });

    // ===== QRIS modal =====
    const modal = $('#qrisModal');
    $('#showQris').addEventListener('click', ()=> modal.classList.add('open'));
    $('#closeQris').addEventListener('click', ()=> modal.classList.remove('open'));
    $('#downloadQris').addEventListener('click', ()=>{
      const a = document.createElement('a');
      a.href = $('#qrisImg').src; a.download = 'qris.png'; a.click();
    });

    // ===== Google Identity =====
    // Important: replace YOUR_GOOGLE_CLIENT_ID in #g_id_onload above.
    window.onGoogleCredential = function (response){
      try{
        const data = parseJwt(response.credential);
        const name = data.name || 'Pengguna';
        const email = data.email || '';
        const picture = data.picture || '';

        showApp({name, email, picture});
      }catch(err){
        console.error('GIS parse error', err);
      }
    };

    function parseJwt(token){
      const base64 = token.split('.')[1].replace(/-/g,'+').replace(/_/g,'/');
      const payload = decodeURIComponent(atob(base64).split('').map(c=>'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2)).join(''));
      return JSON.parse(payload);
    }

    <script>
// Simpan user ke "database.json" versi LocalStorage
function register(username, password) {
  let db = JSON.parse(localStorage.getItem("database")) || [];
  if (db.find(u => u.username === username)) {
    alert("Username sudah ada!");
    return;
  }
  let newUser = { username, password, email: username+"@gmail.com", name: username, tanggalLogin: new Date().toISOString() };
  db.push(newUser);
  localStorage.setItem("database", JSON.stringify(db));
  alert("Register berhasil!");
}

// Login user
function login(username, password) {
  let db = JSON.parse(localStorage.getItem("database")) || [];
  let user = db.find(u => u.username === username && u.password === password);
  if (user) {
    user.tanggalLogin = new Date().toISOString();
    localStorage.setItem("database", JSON.stringify(db));
    showApp(user); // kalau sukses, langsung panggil showApp
  } else {
    alert("Username atau password salah!");
  }
}

// Fungsi showApp kamu (dari kode sebelumnya)
function showApp(user){
  document.getElementById("splash").style.display = "none";
  document.getElementById("app").style.display = "block";

  document.getElementById("userName").textContent = user.name;
  document.getElementById("userEmail").textContent = user.email;
  document.getElementById("userAvatar").textContent = (user.name || 'U').trim().charAt(0).toUpperCase();
  document.getElementById("greetText").innerHTML = `Halo <b>${user.name.split(' ')[0]}</b>! Selamat datang di website payment <b>Warung Pedia</b>!`;

  localStorage.setItem('wp_user', JSON.stringify(user));
}

// Logout
document.getElementById("signOutBtn").addEventListener("click", ()=>{
  localStorage.removeItem("wp_user");
  document.getElementById("app").style.display = "none";
  document.getElementById("splash").style.display = "flex";
});

// Auto login kalau ada session
(function(){
  const saved = localStorage.getItem("wp_user");
  if(saved){
    try{ showApp(JSON.parse(saved)); }catch(e){}
  }
})();
</script>
</body>
  </html>
